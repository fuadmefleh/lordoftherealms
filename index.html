<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lord of the Realms</title>
    <meta name="description"
        content="Rise from nobody to ruler in a dynamic hex-grid world of kingdoms, trade, warfare, and faith.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Inter:wght@300;400;500;600;700&family=MedievalSharp&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body oncontextmenu="return false;">
    <!-- Main Game Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- Top Bar -->
    <div id="topBar">
        <div id="topBarLeft">
            <div class="stat-item" id="goldStat">
                <span class="stat-icon">üí∞</span>
                <span class="stat-label">Gold</span>
                <span class="stat-value" id="goldValue">100</span>
            </div>
            <div class="stat-item" id="karmaStat">
                <span class="stat-icon">‚òØ</span>
                <span class="stat-label">Karma</span>
                <span class="stat-value" id="karmaValue">0</span>
            </div>
            <div class="stat-item" id="reputationStat">
                <span class="stat-icon">‚≠ê</span>
                <span class="stat-label">Renown</span>
                <span class="stat-value" id="renownValue">0</span>
            </div>
            <div class="stat-item" id="movementStat">
                <span class="stat-icon">üèÉ</span>
                <span class="stat-label">Movement</span>
                <span class="stat-value" id="movementValue">10/10</span>
            </div>
            <div class="stat-item" id="apStat">
                <span class="stat-icon">‚ö°</span>
                <span class="stat-label">Actions</span>
                <span class="stat-value" id="apValue">10/10</span>
            </div>
            <div class="stat-item" id="foodStat">
                <span class="stat-icon">üçû</span>
                <span class="stat-label">Food</span>
                <span class="stat-value" id="foodValue">20</span>
            </div>
            <div class="stat-item" id="hpStat">
                <span class="stat-icon">‚ù§Ô∏è</span>
                <span class="stat-label">HP</span>
                <span class="stat-value" id="hpValue">100/100</span>
            </div>
        </div>
        <div id="topBarCenter">
            <span id="gameTitle">Lord of the Realms</span>
            <span id="turnDisplay">Day 1 ‚Äî Spring, Year 1</span>
        </div>
        <div id="topBarRight">
            <!-- Civ-style grouped menu buttons -->
            <div class="civ-menu-group">
                <button class="civ-menu-btn" id="civMapBtn" title="Map Options">
                    <span class="civ-menu-icon">üó∫Ô∏è</span>
                    <span class="civ-menu-label">Map</span>
                </button>
                <div class="civ-dropdown" id="civMapDropdown">
                    <button class="civ-dropdown-item" id="btnToggleResources">
                        <span class="civ-dd-icon">üíé</span>
                        <span class="civ-dd-text">Resource Icons</span>
                        <span class="civ-dd-toggle" id="resourceToggleState">OFF</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnToggleBorders">
                        <span class="civ-dd-icon">üè∞</span>
                        <span class="civ-dd-text">Kingdom Borders</span>
                        <span class="civ-dd-toggle" id="borderToggleState">OFF</span>
                    </button>
                    <div class="civ-dd-separator"></div>
                    <button class="civ-dropdown-item" id="btnMapModes">
                        <span class="civ-dd-icon">üìä</span>
                        <span class="civ-dd-text">Map Modes</span>
                    </button>
                </div>
            </div>

            <div class="civ-menu-group">
                <button class="civ-menu-btn" id="civEmpireBtn" title="Empire Overview">
                    <span class="civ-menu-icon">üëë</span>
                    <span class="civ-menu-label">Empire</span>
                </button>
                <div class="civ-dropdown" id="civEmpireDropdown">
                    <button class="civ-dropdown-item" id="btnCharacter">
                        <span class="civ-dd-icon">üë§</span>
                        <span class="civ-dd-text">Character</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnInventory">
                        <span class="civ-dd-icon">üéí</span>
                        <span class="civ-dd-text">Inventory</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnTreasury">
                        <span class="civ-dd-icon">üí∞</span>
                        <span class="civ-dd-text">Treasury & Market</span>
                    </button>
                    <div class="civ-dd-separator"></div>
                    <button class="civ-dropdown-item" id="btnTechnology">
                        <span class="civ-dd-icon">üî¨</span>
                        <span class="civ-dd-text">Technology</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnReligion">
                        <span class="civ-dd-icon">üôè</span>
                        <span class="civ-dd-text">Religion & Culture</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnPeoples">
                        <span class="civ-dd-icon">üèõÔ∏è</span>
                        <span class="civ-dd-text">Peoples</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnRelationships">
                        <span class="civ-dd-icon">üíï</span>
                        <span class="civ-dd-text">Relationships</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnTravelParty">
                        <span class="civ-dd-icon">üß≠</span>
                        <span class="civ-dd-text">Travel Party</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnCouncil">
                        <span class="civ-dd-icon">üèõÔ∏è</span>
                        <span class="civ-dd-text">Council</span>
                    </button>
                </div>
            </div>

            <div class="civ-menu-group">
                <button class="civ-menu-btn" id="civJournalBtn" title="Reports & History">
                    <span class="civ-menu-icon">üìú</span>
                    <span class="civ-menu-label">Journal</span>
                </button>
                <div class="civ-dropdown" id="civJournalDropdown">
                    <button class="civ-dropdown-item" id="btnQuests">
                        <span class="civ-dd-icon">üìú</span>
                        <span class="civ-dd-text">Quests</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnHistory">
                        <span class="civ-dd-icon">üï∞Ô∏è</span>
                        <span class="civ-dd-text">World History</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnDynasties">
                        <span class="civ-dd-icon">üëë</span>
                        <span class="civ-dd-text">Dynasties</span>
                    </button>
                    <button class="civ-dropdown-item" id="btnIntel">
                        <span class="civ-dd-icon">üìñ</span>
                        <span class="civ-dd-text">Intel Journal</span>
                    </button>
                    <div class="civ-dd-separator"></div>
                    <button class="civ-dropdown-item" id="btnEventLog">
                        <span class="civ-dd-icon">üìã</span>
                        <span class="civ-dd-text">Event Log</span>
                    </button>
                </div>
            </div>

            <div class="civ-separator-vert"></div>

            <!-- Prominent End Turn button (Civ-style) -->
            <button class="civ-end-turn-btn" id="btnEndTurn" title="End Day">
                <span class="civ-end-turn-label">End Day</span>
                <span class="civ-end-turn-icon">‚è≠</span>
            </button>

            <button class="civ-audio-btn" id="btnAudioToggle" title="Toggle Music"><span class="audio-icon">üîä</span></button>
            <button class="civ-settings-btn" id="btnSettings" title="Settings">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- Minimap -->
    <div id="minimapContainer">
        <div id="minimapLabel">World Map</div>
        <canvas id="minimapCanvas"></canvas>
        <div id="minimapViewport"></div>
    </div>

    <!-- Hex Info Panel (shows on hover/click) -->
    <div id="hexInfoPanel" class="side-panel hidden">
        <div class="panel-header">
            <span id="hexInfoTitle">Tile Info</span>
            <button class="panel-close" id="hexInfoClose">‚úï</button>
        </div>
        <div class="panel-body" id="hexInfoBody">
            <!-- Dynamic content -->
        </div>
    </div>

    <!-- Kingdom Info Panel -->
    <div id="kingdomPanel" class="side-panel hidden">
        <div class="panel-header">
            <span id="kingdomTitle">Kingdom</span>
            <button class="panel-close" id="kingdomClose">‚úï</button>
        </div>
        <div class="panel-body" id="kingdomBody">
            <!-- Dynamic content -->
        </div>
    </div>

    <!-- Character Panel -->
    <div id="characterPanel" class="modal-panel hidden">
        <div class="modal-header">
            <span>Character Sheet</span>
            <button class="panel-close" id="characterClose">‚úï</button>
        </div>
        <div class="modal-body" id="characterBody">
            <!-- Dynamic content -->
        </div>
    </div>

    <!-- Notification Area -->
    <div id="notificationArea"></div>

    <!-- Tooltip -->
    <div id="tooltip" class="hidden"></div>

    <!-- Title Screen Overlay -->
    <div id="titleScreen">
        <div id="titleContent">
            <h1 id="titleText">Lord of the Realms</h1>
            <p id="titleSubtext">Rise from Nothing. Forge Your Legacy.</p>
            <div id="titleButtons">
                <button class="title-btn primary" id="btnNewGame">New Game</button>
                <button class="title-btn" id="btnContinue" disabled>Continue</button>
            </div>
            <div id="titleVersion">v0.1.0 ‚Äî Early Foundation</div>
        </div>
        <canvas id="titleBgCanvas"></canvas>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden">
        <div id="loadingContent">
            <div class="loading-spinner"></div>
            <p id="loadingText">Generating World...</p>
            <p id="loadingSubtext">Forging continents and oceans</p>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settingsScreen" class="hidden">
        <div id="settingsContent">
            <h2 class="settings-title">New Game Initialization</h2>

            <!-- Map Size Presets -->
            <div class="settings-presets">
                <span class="preset-label">Map Size:</span>
                <button class="preset-btn" data-preset="tiny">Tiny</button>
                <button class="preset-btn" data-preset="small">Small</button>
                <button class="preset-btn active" data-preset="medium">Medium</button>
                <button class="preset-btn" data-preset="large">Large</button>
                <button class="preset-btn" data-preset="huge">Huge</button>
                <button class="preset-btn" data-preset="epic">Epic</button>
            </div>

            <div class="settings-groups-container">
                <!-- Character Settings -->
                <div class="settings-group">
                    <h3>Character Profile</h3>
                    <div class="input-row">
                        <label for="charFirstName">First Name:</label>
                        <input type="text" id="charFirstName" placeholder="Wanderer" maxlength="16">
                    </div>
                    <div class="input-row">
                        <label for="charLastName">Last Name:</label>
                        <input type="text" id="charLastName" placeholder="" maxlength="16">
                    </div>
                    <div class="input-row">
                        <label for="charGender">Gender:</label>
                        <select id="charGender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="charAge">Age:</label>
                        <input type="number" id="charAge" value="20" min="16" max="60">
                    </div>
                </div>

                <!-- World Size Settings -->
                <div class="settings-group">
                    <h3>World Dimensions</h3>
                    <div class="input-row">
                        <label for="worldWidth">Width:</label>
                        <input type="range" id="worldWidth" min="40" max="500" value="120">
                        <span class="range-value" id="valWorldWidth">120</span>
                    </div>
                    <div class="input-row">
                        <label for="worldHeight">Height:</label>
                        <input type="range" id="worldHeight" min="30" max="350" value="80">
                        <span class="range-value" id="valWorldHeight">80</span>
                    </div>
                    <div class="input-row">
                        <label for="mapSeed">Seed:</label>
                        <input type="text" id="mapSeed" placeholder="Random" maxlength="20">
                    </div>
                </div>

                <!-- Continent & Landmass Settings -->
                <div class="settings-group">
                    <h3>Continents & Land</h3>
                    <div class="input-row">
                        <label for="continentCount">Continents:</label>
                        <input type="range" id="continentCount" min="1" max="15" value="3">
                        <span class="range-value" id="valContinentCount">3</span>
                    </div>
                    <div class="input-row">
                        <label for="continentSize">Continent Size:</label>
                        <select id="continentSize">
                            <option value="small">Small (many islands)</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large (sprawling)</option>
                            <option value="pangaea">Pangaea (one mass)</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="islandFreq">Islands:</label>
                        <input type="range" id="islandFreq" min="0" max="5" step="0.1" value="1.0">
                        <span class="range-value" id="valIslandFreq">1.0</span>
                    </div>
                    <div class="input-row">
                        <label for="landMass">Land Coverage:</label>
                        <input type="range" id="landMass" min="15" max="85" value="45">
                        <span class="range-value range-value-pct" id="valLandMass">45%</span>
                    </div>
                </div>

                <!-- Water & Ocean Settings -->
                <div class="settings-group">
                    <h3>Water & Oceans</h3>
                    <div class="input-row">
                        <label for="waterLevel">Sea Level:</label>
                        <input type="range" id="waterLevel" min="0.20" max="0.60" step="0.01" value="0.42">
                        <span class="range-value" id="valWaterLevel">0.42</span>
                    </div>
                    <div class="input-row">
                        <label for="riverCount">Rivers:</label>
                        <input type="range" id="riverCount" min="0" max="200" value="40">
                        <span class="range-value" id="valRiverCount">40</span>
                    </div>
                    <div class="input-row">
                        <label for="lakeFreq">Lakes:</label>
                        <select id="lakeFreq">
                            <option value="none">None</option>
                            <option value="few">Few</option>
                            <option value="normal" selected>Normal</option>
                            <option value="many">Many</option>
                            <option value="abundant">Abundant</option>
                        </select>
                    </div>
                </div>

                <!-- Terrain & Elevation -->
                <div class="settings-group">
                    <h3>Terrain & Elevation</h3>
                    <div class="input-row">
                        <label for="terrainFreq">Land Density:</label>
                        <input type="range" id="terrainFreq" min="0.5" max="3.0" step="0.1" value="1.1">
                        <span class="range-value" id="valTerrainFreq">1.1</span>
                    </div>
                    <div class="input-row">
                        <label for="mountainDensity">Mountains:</label>
                        <input type="range" id="mountainDensity" min="0" max="200" value="100">
                        <span class="range-value range-value-pct" id="valMountainDensity">100%</span>
                    </div>
                    <div class="input-row">
                        <label for="hillDensity">Hills:</label>
                        <input type="range" id="hillDensity" min="0" max="200" value="100">
                        <span class="range-value range-value-pct" id="valHillDensity">100%</span>
                    </div>
                    <div class="input-row">
                        <label for="flatness">Flatness:</label>
                        <select id="flatness">
                            <option value="rugged">Rugged</option>
                            <option value="normal" selected>Normal</option>
                            <option value="flat">Flat</option>
                            <option value="veryFlat">Very Flat</option>
                        </select>
                    </div>
                </div>

                <!-- Climate & Biome -->
                <div class="settings-group">
                    <h3>Climate & Biome</h3>
                    <div class="input-row">
                        <label for="temperature">Temperature:</label>
                        <select id="temperature">
                            <option value="frozen">Frozen World</option>
                            <option value="cold">Cold</option>
                            <option value="cool">Cool</option>
                            <option value="normal" selected>Normal</option>
                            <option value="warm">Warm</option>
                            <option value="hot">Hot</option>
                            <option value="scorching">Scorching</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="rainfall">Rainfall:</label>
                        <select id="rainfall">
                            <option value="arid">Arid</option>
                            <option value="dry">Dry</option>
                            <option value="normal" selected>Normal</option>
                            <option value="wet">Wet</option>
                            <option value="tropical">Tropical</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="polarIce">Polar Ice:</label>
                        <select id="polarIce">
                            <option value="none">None</option>
                            <option value="minimal">Minimal</option>
                            <option value="normal" selected>Normal</option>
                            <option value="extensive">Extensive</option>
                            <option value="iceAge">Ice Age</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="desertFreq">Deserts:</label>
                        <select id="desertFreq">
                            <option value="none">None</option>
                            <option value="few">Few</option>
                            <option value="normal" selected>Normal</option>
                            <option value="many">Many</option>
                            <option value="wasteland">Wasteland</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="forestDensity">Forests:</label>
                        <input type="range" id="forestDensity" min="0" max="200" value="100">
                        <span class="range-value range-value-pct" id="valForestDensity">100%</span>
                    </div>
                </div>

                <!-- Resources -->
                <div class="settings-group">
                    <h3>Resources</h3>
                    <div class="input-row">
                        <label for="resourceDensity">Resource Amount:</label>
                        <select id="resourceDensity">
                            <option value="scarce">Scarce</option>
                            <option value="low">Low</option>
                            <option value="normal" selected>Normal</option>
                            <option value="abundant">Abundant</option>
                            <option value="rich">Rich</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="strategicRes">Strategic Res.:</label>
                        <select id="strategicRes">
                            <option value="scarce">Scarce</option>
                            <option value="normal" selected>Normal</option>
                            <option value="abundant">Abundant</option>
                        </select>
                    </div>
                </div>

                <!-- Kingdoms & Population -->
                <div class="settings-group">
                    <h3>Kingdoms & World</h3>
                    <div class="input-row">
                        <label for="kingdomCount">Kingdoms:</label>
                        <input type="range" id="kingdomCount" min="2" max="20" value="6">
                        <span class="range-value" id="valKingdomCount">6</span>
                    </div>
                    <div class="input-row">
                        <label for="independentSettlements">Independent Towns:</label>
                        <select id="independentSettlements">
                            <option value="none">None</option>
                            <option value="few">Few</option>
                            <option value="normal" selected>Normal</option>
                            <option value="many">Many</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label for="ruinsFreq">Ruins & POI:</label>
                        <select id="ruinsFreq">
                            <option value="none">None</option>
                            <option value="few">Few</option>
                            <option value="normal" selected>Normal</option>
                            <option value="many">Many</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings Toggle -->
            <details class="advanced-settings">
                <summary>Advanced Generation Parameters</summary>
                <div class="settings-groups-container">
                    <div class="settings-group">
                        <h3>Noise Parameters</h3>
                        <div class="input-row">
                            <label for="terrainOctaves">Terrain Detail:</label>
                            <input type="range" id="terrainOctaves" min="2" max="10" value="6">
                            <span class="range-value" id="valTerrainOctaves">6</span>
                        </div>
                        <div class="input-row">
                            <label for="heatFreq">Heat Variation:</label>
                            <input type="range" id="heatFreq" min="1.0" max="6.0" step="0.1" value="3.0">
                            <span class="range-value" id="valHeatFreq">3.0</span>
                        </div>
                        <div class="input-row">
                            <label for="moistFreq">Moisture Var.:</label>
                            <input type="range" id="moistFreq" min="0.5" max="5.0" step="0.1" value="2.0">
                            <span class="range-value" id="valMoistFreq">2.0</span>
                        </div>
                        <div class="input-row">
                            <label for="coastalDetail">Coast Detail:</label>
                            <input type="range" id="coastalDetail" min="1" max="10" value="5">
                            <span class="range-value" id="valCoastalDetail">5</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>Elevation Thresholds</h3>
                        <div class="input-row">
                            <label for="deepWaterLevel">Deep Water:</label>
                            <input type="range" id="deepWaterLevel" min="0.05" max="0.35" step="0.01" value="0.20">
                            <span class="range-value" id="valDeepWaterLevel">0.20</span>
                        </div>
                        <div class="input-row">
                            <label for="hillsLevel">Hills Threshold:</label>
                            <input type="range" id="hillsLevel" min="0.45" max="0.75" step="0.01" value="0.52">
                            <span class="range-value" id="valHillsLevel">0.52</span>
                        </div>
                        <div class="input-row">
                            <label for="mountainLevel">Mountain Threshold:</label>
                            <input type="range" id="mountainLevel" min="0.55" max="0.90" step="0.01" value="0.70">
                            <span class="range-value" id="valMountainLevel">0.70</span>
                        </div>
                        <div class="input-row">
                            <label for="snowPeakLevel">Snow Peak Level:</label>
                            <input type="range" id="snowPeakLevel" min="0.75" max="0.98" step="0.01" value="0.88">
                            <span class="range-value" id="valSnowPeakLevel">0.88</span>
                        </div>
                    </div>
                </div>
            </details>

            <div class="settings-actions">
                <button class="title-btn" id="btnBackToTitle">Back</button>
                <button class="title-btn" id="btnRandomize">üé≤ Randomize</button>
                <button class="title-btn primary" id="btnStartGame">Forge My Destiny</button>
            </div>
        </div>
    </div>

    <!-- Scripts ‚Äî Core -->
    <script src="js/core/utils.js"></script>
    <script src="js/core/hex.js"></script>
    <script src="js/core/dataLoader.js"></script>

    <!-- Scripts ‚Äî World -->
    <script src="js/world/terrain.js"></script>
    <script src="js/world/kingdom.js"></script>
    <script src="js/world/economy.js"></script>
    <script src="js/world/kingdomAI.js"></script>
    <script src="js/world/worldEvents.js"></script>
    <script src="js/world/characters.js"></script>
    <script src="js/world/npcLords.js"></script>
    <script src="js/world/weather.js"></script>
    <script src="js/world/units.js"></script>
    <script src="js/world/world.js"></script>
    <script src="js/world/colonization.js"></script>
    <script src="js/world/innerMap.js"></script>

    <!-- Scripts ‚Äî Player (loaded before Systems that depend on it) -->
    <script src="js/player/player.js"></script>
    <script src="js/player/playerEconomy.js"></script>

    <!-- Scripts ‚Äî Systems -->
    <script src="js/systems/quests.js"></script>
    <script src="js/systems/legendaryArtifacts.js"></script>
    <script src="js/systems/bountyHunting.js"></script>
    <script src="js/systems/festivals.js"></script>
    <script src="js/systems/achievements.js"></script>
    <script src="js/systems/saveLoad.js"></script>
    <script src="js/systems/technology.js"></script>
    <script src="js/systems/infrastructure.js"></script>
    <script src="js/systems/religion.js"></script>
    <script src="js/systems/culture.js"></script>
    <script src="js/systems/peoples.js"></script>
    <script src="js/systems/cartography.js"></script>
    <script src="js/systems/marketDynamics.js"></script>
    <script src="js/systems/relationships.js"></script>
    <script src="js/systems/housing.js"></script>
    <script src="js/systems/ships.js"></script>
    <script src="js/systems/titles.js"></script>
    <script src="js/systems/councils.js"></script>
    <script src="js/systems/espionage.js"></script>
    <script src="js/systems/audio.js"></script>

    <!-- Scripts ‚Äî Player (remaining) -->
    <script src="js/player/tavern.js"></script>
    <script src="js/player/playerMilitary.js"></script>
    <script src="js/player/playerReligion.js"></script>
    <script src="js/player/playerActions.js"></script>

    <!-- Scripts ‚Äî UI -->
    <script src="js/ui/camera.js"></script>
    <script src="js/ui/renderer.js"></script>
    <script src="js/ui/innerMapRenderer.js"></script>
    <script src="js/ui/ui.js"></script>
    <script src="js/ui/actionMenu.js"></script>
    <script src="js/ui/minimap.js"></script>
    <script src="js/ui/game.js"></script>
</body>

</html>